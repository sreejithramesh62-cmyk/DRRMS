<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title><title>Disaster Relief Resource Management System(DRRMS)-User</title>
</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root{
  --primary:#3b82f6;--primary-light:#60a5fa;--primary-dark:#2563eb;
  --bg-dark:#0a0e1a;--bg-card:#12172a;--bg-hover:#1a2138;
  --text:#e8f0ff;--text-muted:#8b96a8;--border:#1e2840;
  --success:#10b981;--error:#ef4444;--warning:#f59e0b;--info:#3b82f6;
  --shadow:0 20px 60px rgba(0,0,0,.5);--glow:0 0 20px rgba(59,130,246,.3);
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:'Inter',system-ui,sans-serif;background:#0a0e1a;color:var(--text);
  background-image:
    radial-gradient(circle at 20% 50%, rgba(59,130,246,.03) 0%, transparent 50%),
    radial-gradient(circle at 80% 80%, rgba(16,185,129,.03) 0%, transparent 50%);
  min-height:100vh;overflow-x:hidden;
}

.header{
  position:sticky;top:0;z-index:100;
  background:linear-gradient(180deg,rgba(18,23,42,.95),rgba(18,23,42,.85));
  backdrop-filter:blur(20px);border-bottom:1px solid var(--border);
  padding:16px 24px;display:flex;justify-content:space-between;align-items:center;
  box-shadow:0 4px 30px rgba(0,0,0,.4);animation:slideDown .5s ease;
}
@keyframes slideDown{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:none}}

.logo{display:flex;align-items:center;gap:12px}
.logo-icon{
  width:48px;height:48px;border-radius:12px;
  background:linear-gradient(135deg,var(--primary),var(--primary-dark));
  display:grid;place-items:center;font-size:24px;font-weight:900;
  box-shadow:var(--glow);
}
.logo h1{font-size:22px;font-weight:800;letter-spacing:-.5px;background:linear-gradient(135deg,var(--primary-light),var(--primary));-webkit-background-clip:text;-webkit-text-fill-color:transparent}

.user-menu{display:flex;align-items:center;gap:16px}
.user-avatar{
  width:40px;height:40px;border-radius:50%;
  background:linear-gradient(135deg,var(--primary),var(--success));
  display:grid;place-items:center;font-weight:700;font-size:16px;
}
.logout-btn{
  padding:10px 18px;border-radius:10px;background:rgba(239,68,68,.1);
  border:1px solid #ef4444;color:#ff9b9b;cursor:pointer;font-weight:600;
  transition:.25s;font-size:13px;
}
.logout-btn:hover{background:#ef4444;color:#fff;transform:translateY(-2px)}

.main{padding:24px;max-width:1600px;margin:0 auto}

.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px;margin-bottom:24px}
.stat-card{
  background:var(--bg-card);border:1px solid var(--border);border-radius:16px;
  padding:24px;position:relative;overflow:hidden;transition:.3s;
  box-shadow:var(--shadow);animation:fadeUp .5s ease backwards;
}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}
.stat-card:nth-child(1){animation-delay:.05s}
.stat-card:nth-child(2){animation-delay:.1s}
.stat-card:nth-child(3){animation-delay:.15s}
.stat-card:nth-child(4){animation-delay:.2s}
.stat-card::before{
  content:'';position:absolute;top:-50%;right:-50%;width:200%;height:200%;
  background:radial-gradient(circle,rgba(59,130,246,.08),transparent 70%);
  opacity:0;transition:.3s;
}
.stat-card:hover{transform:translateY(-4px);box-shadow:0 30px 80px rgba(0,0,0,.6)}
.stat-card:hover::before{opacity:1}

.stat-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.stat-label{font-size:13px;font-weight:600;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px}
.stat-icon{width:48px;height:48px;border-radius:12px;display:grid;place-items:center;font-size:24px;background:rgba(59,130,246,.1)}
.stat-value{font-size:36px;font-weight:800;color:var(--primary);margin-bottom:8px;text-shadow:0 0 20px rgba(59,130,246,.3)}
.stat-trend{font-size:13px;color:var(--success);font-weight:500}

.panel{
  background:var(--bg-card);border:1px solid var(--border);border-radius:16px;
  padding:20px;box-shadow:var(--shadow);margin-bottom:20px;
  animation:fadeUp .5s ease .25s backwards;
}
.panel-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.panel-title{font-size:18px;font-weight:700;color:var(--text)}

.btn{
  padding:10px 16px;border-radius:10px;border:1px solid var(--border);
  background:var(--bg-hover);color:var(--text);cursor:pointer;transition:.25s;
  font-weight:600;font-size:13px;
}
.btn:hover{background:var(--primary);color:#fff;transform:translateY(-2px);box-shadow:0 8px 20px rgba(59,130,246,.3)}
.btn.primary{background:var(--primary);border-color:var(--primary);color:#fff}
.btn.success{background:var(--success);border-color:var(--success);color:#fff}

table{width:100%;border-collapse:collapse}
th{text-align:left;padding:12px;font-size:12px;font-weight:600;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px;border-bottom:1px solid var(--border)}
td{padding:14px 12px;border-bottom:1px solid var(--border);font-size:14px}
tr{transition:.2s}
tr:hover{background:var(--bg-hover)}

.badge{
  padding:6px 12px;border-radius:999px;font-size:11px;font-weight:600;
  display:inline-block;text-transform:uppercase;letter-spacing:.5px;
}
.badge.success{background:rgba(16,185,129,.15);color:var(--success);border:1px solid var(--success)}
.badge.error{background:rgba(239,68,68,.15);color:var(--error);border:1px solid var(--error)}
.badge.warning{background:rgba(245,158,11,.15);color:var(--warning);border:1px solid var(--warning)}
.badge.info{background:rgba(59,130,246,.15);color:var(--info);border:1px solid var(--info)}

.notif-list{list-style:none;max-height:350px;overflow-y:auto}
.notif-item{
  padding:14px;background:var(--bg-dark);border-radius:10px;
  margin-bottom:10px;border:1px solid var(--border);transition:.2s;
}
.notif-item:hover{background:var(--bg-hover)}
.notif-title{font-weight:600;color:var(--primary-light);margin-bottom:4px;font-size:14px}
.notif-msg{font-size:13px;color:var(--text-muted);line-height:1.5}
.notif-time{font-size:11px;color:var(--text-muted);margin-top:6px}

.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:999;align-items:center;justify-content:center;backdrop-filter:blur(8px)}
.modal.show{display:flex}
.modal-content{
  background:var(--bg-card);border:1px solid var(--border);border-radius:20px;
  padding:32px;width:90%;max-width:600px;box-shadow:0 40px 100px rgba(0,0,0,.8);
  animation:zoomIn .3s ease;max-height:90vh;overflow-y:auto;
}
@keyframes zoomIn{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}
.modal h3{margin-bottom:20px;color:var(--primary);font-size:24px;font-weight:700}
.modal input,.modal textarea,.modal select{
  width:100%;padding:14px;border-radius:10px;border:1px solid var(--border);
  background:var(--bg-dark);color:var(--text);margin:12px 0;font-family:inherit;font-size:14px;
}
.modal-actions{display:flex;gap:12px;margin-top:20px}
.form-label{display:block;margin:12px 0 6px;color:var(--text);font-weight:600;font-size:14px}

.grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
@media(max-width:768px){.grid{grid-template-columns:1fr}}

.status-active{color:var(--success);font-weight:600}

/* Admin list grid */
.admin-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:12px;margin:16px 0}
.admin-card{
  background:var(--bg-dark);border:1px solid var(--border);border-radius:12px;
  padding:16px;text-align:center;cursor:pointer;transition:.2s;
}
.admin-card:hover{background:var(--bg-hover);transform:translateY(-2px);border-color:var(--primary)}
.admin-avatar{
  width:48px;height:48px;border-radius:50%;
  background:linear-gradient(135deg,var(--primary),var(--success));
  display:grid;place-items:center;font-weight:700;font-size:20px;margin:0 auto 8px;
}
.admin-name{font-weight:600;color:var(--text);font-size:13px}
</style>
</head>
<body>

<header class="header">
  <div class="logo">
  <img src="logo.jpg" alt="DRRMS Logo" style="width:48px;height:48px;border-radius:12px;"/>
  <h1>DRRMS</h1>
</div>

  <div class="user-menu">
    <span id="userName" style="font-weight:600;color:var(--text-muted)">User</span>
    <div class="user-avatar">U</div>
    <button class="logout-btn" onclick="logout()">Logout</button>
  </div>
</header>

<main class="main">
  
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-label">Active Disasters</div>
        <div class="stat-icon">‚ö†Ô∏è</div>
      </div>
      <div class="stat-value" id="statEvents">0</div>
      <div class="stat-trend">‚Üó Ongoing emergencies</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-label">Available Resources</div>
        <div class="stat-icon">üì¶</div>
      </div>
      <div class="stat-value" id="statResources">0</div>
      <div class="stat-trend">‚úì Stock units</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-label">Active Volunteers</div>
        <div class="stat-icon">üë•</div>
      </div>
      <div class="stat-value" id="statVolunteers">0</div>
      <div class="stat-trend">üöÄ On ground now</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-label">My Status</div>
        <div class="stat-icon">‚úÖ</div>
      </div>
      <div class="stat-value status-active">Active</div>
      <div class="stat-trend">üìç Ready to help</div>
    </div>
  </div>

  <div class="grid">
    
    <div>
      <div class="panel">
        <div class="panel-header">
          <h2 class="panel-title">Active Disasters</h2>
          <button class="btn" onclick="loadEvents()">Refresh</button>
        </div>
        <table id="tblEvents">
          <thead><tr><th>Event</th><th>Location</th><th>Severity</th><th>Date</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="panel">
        <div class="panel-header">
          <h2 class="panel-title">Available Resources</h2>
          <button class="btn" onclick="loadResources()">Refresh</button>
        </div>
        <table id="tblResources">
          <thead><tr><th>Resource</th><th>Quantity</th><th>Status</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div>
      <div class="panel">
        <div class="panel-header">
          <h2 class="panel-title">Quick Actions</h2>
        </div>
        <button class="btn success" onclick="openVolunteerModal()" style="width:100%;margin-bottom:10px">üôã Volunteer for Event</button>
        <button class="btn primary" onclick="openResourceModal()" style="width:100%;margin-bottom:10px">üì¶ Request Resources</button>
        <button class="btn" onclick="openContactModal()" style="width:100%">üí¨ Contact Admin</button>
      </div>

      <div class="panel">
        <div class="panel-header">
          <h2 class="panel-title">Recent Notifications</h2>
          <button class="btn" onclick="loadNotifications()">Refresh</button>
        </div>
        <ul id="notifList" class="notif-list"></ul>
      </div>
    </div>

  </div>

  <div class="panel">
    <div class="panel-header">
      <h2 class="panel-title">Active Volunteers</h2>
      <button class="btn" onclick="loadVolunteers()">Refresh</button>
    </div>
    <table id="tblVolunteers">
      <thead><tr><th>Name</th><th>Contact</th><th>Status</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

</main>

<!-- Volunteer Request Modal -->
<div id="volunteerModal" class="modal">
  <div class="modal-content">
    <h3>üôã Volunteer for Event</h3>
    <form onsubmit="submitVolunteerRequest(event)">
      <label class="form-label">Select Event</label>
      <select id="selectEvent" required></select>
      <label class="form-label">Your Message (Optional)</label>
      <textarea id="volunteerMsg" rows="4" placeholder="Why do you want to volunteer?"></textarea>
      <div class="modal-actions">
        <button type="submit" class="btn success">Submit Request</button>
        <button type="button" class="btn" onclick="closeVolunteerModal()">Cancel</button>
      </div>
    </form>
  </div>
</div>

<!-- Resource Request Modal -->
<div id="resourceModal" class="modal">
  <div class="modal-content">
    <h3>üì¶ Request Resources</h3>
    <form onsubmit="submitResourceRequest(event)">
      <label class="form-label">Resource Name</label>
      <input type="text" id="resourceName" placeholder="e.g., Water Bottles, Food Packets" required/>
      <label class="form-label">Quantity Needed</label>
      <input type="number" id="resourceQty" placeholder="Enter quantity" min="1" required/>
      <label class="form-label">Camp/Location</label>
      <input type="text" id="campLocation" placeholder="Where do you need this?" required/>
      <label class="form-label">Urgency Level</label>
      <select id="urgencyLevel">
        <option value="Low">Low</option>
        <option value="Medium" selected>Medium</option>
        <option value="High">High</option>
        <option value="Critical">Critical</option>
      </select>
      <label class="form-label">Additional Details</label>
      <textarea id="resourceMsg" rows="3" placeholder="Any additional information..."></textarea>
      <div class="modal-actions">
        <button type="submit" class="btn primary">Submit Request</button>
        <button type="button" class="btn" onclick="closeResourceModal()">Cancel</button>
      </div>
    </form>
  </div>
</div>

<!-- Contact Admin Modal -->
<div id="contactModal" class="modal">
  <div class="modal-content">
    <h3>üí¨ Contact Admin</h3>
    <label class="form-label">Select Admin</label>
    <div id="adminGrid" class="admin-grid"></div>
    <form onsubmit="sendAdminMessage(event)">
      <input type="hidden" id="selectedAdminId"/>
      <label class="form-label">Subject</label>
      <input type="text" id="messageSubject" placeholder="Message subject" required/>
      <label class="form-label">Message</label>
      <textarea id="messageContent" rows="5" placeholder="Your message to admin..." required></textarea>
      <div class="modal-actions">
        <button type="submit" class="btn success">Send Message</button>
        <button type="button" class="btn" onclick="closeContactModal()">Cancel</button>
      </div>
    </form>
  </div>
</div>

<script>
const API = '/drrms/api/index.php';
const userName = localStorage.getItem('userName') || 'User';
const userId = localStorage.getItem('userId') || 1;
document.getElementById('userName').textContent = userName;

async function jget(path){ const r = await fetch(API + path); if (!r.ok) throw new Error(path); return r.json(); }
async function jpost(path, body){ const r = await fetch(API + path, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body)}); if (!r.ok) throw new Error(path); return r.json(); }

function logout(){ localStorage.clear(); location.href='login.html'; }

async function loadEvents(){
  try{
    const data = await jget('/user/events');
    document.getElementById('statEvents').textContent = data.length;
    const select = document.getElementById('selectEvent');
    select.innerHTML = '<option value="">Select Event...</option>';
    data.forEach(e => {
      const opt = document.createElement('option');
      opt.value = e.event_id;
      opt.textContent = `${e.event_name} (${e.location})`;
      select.appendChild(opt);
    });
    const tb = document.querySelector('#tblEvents tbody');
    tb.innerHTML = '';
    data.forEach(e => {
      const sevClass = (e.severity||'').toLowerCase().includes('high') || (e.severity||'').toLowerCase().includes('severe') ? 'error' : (e.severity||'').toLowerCase().includes('medium') ? 'warning' : 'success';
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${e.event_name}</td><td>${e.location||'‚Äî'}</td><td><span class="badge ${sevClass}">${e.severity||'‚Äî'}</span></td><td>${e.event_date||'‚Äî'}</td>`;
      tb.appendChild(tr);
    });
  }catch(e){ console.error('Events error:', e); }
}

async function loadResources(){
  try{
    const data = await jget('/user/resources');
    const total = data.reduce((sum, r) => sum + (r.total || 0), 0);
    document.getElementById('statResources').textContent = total;
    const tb = document.querySelector('#tblResources tbody');
    tb.innerHTML = '';
    data.forEach(r => {
      const statusClass = r.total > 100 ? 'success' : r.total > 50 ? 'warning' : 'error';
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${r.resource_name}</td><td><strong>${r.total}</strong></td><td><span class="badge ${statusClass}">Available</span></td>`;
      tb.appendChild(tr);
    });
  }catch(e){ console.error('Resources error:', e); }
}

async function loadVolunteers(){
  try{
    const data = await jget('/user/volunteers');
    document.getElementById('statVolunteers').textContent = data.length;
    const tb = document.querySelector('#tblVolunteers tbody');
    tb.innerHTML = '';
    data.forEach(v => {
      const statusClass = v.status === 'Active' ? 'success' : 'info';
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${v.volunteer_name}</td><td>${v.contact||'‚Äî'}</td><td><span class="badge ${statusClass}">${v.status||'‚Äî'}</span></td>`;
      tb.appendChild(tr);
    });
  }catch(e){ console.error('Volunteers error:', e); }
}

async function loadNotifications(){
  try{
    const notes = await jget('/admin/notifications');
    const ul = document.getElementById('notifList');
    ul.innerHTML = '';
    notes.slice(0,5).forEach(n => {
      const li = document.createElement('li');
      li.className = 'notif-item';
      
      // ‚úÖ IMPORTANT: Show admin name badge prominently
      const adminBadge = n.admin_name 
        ? `<br><span class="badge info" style="font-size:10px;margin-top:6px;display:inline-block">BY ${n.admin_name}</span>` 
        : '';
      
      li.innerHTML = `
        <div class="notif-title">${n.title}</div>
        <div class="notif-msg">${n.message}${adminBadge}</div>
        <div class="notif-time">${new Date(n.created_at).toLocaleString()}</div>
      `;
      ul.appendChild(li);
    });
  }catch(e){ console.error('Notifications error:', e); }
}

async function loadAdmins(){
  try{
    const data = await jget('/admin/get_admins');
    const grid = document.getElementById('adminGrid');
    grid.innerHTML = '';
    data.forEach(a => {
      const card = document.createElement('div');
      card.className = 'admin-card';
      card.onclick = () => selectAdmin(a.admin_id, a.username);
      card.innerHTML = `<div class="admin-avatar">${a.username.charAt(0).toUpperCase()}</div><div class="admin-name">${a.username}</div>`;
      grid.appendChild(card);
    });
  }catch(e){ console.error('Admins error:', e); }
}

function selectAdmin(id, name){
  document.getElementById('selectedAdminId').value = id;
  document.querySelectorAll('.admin-card').forEach(c => c.style.borderColor = 'var(--border)');
  event.currentTarget.style.borderColor = 'var(--primary)';
  alert(`Selected: ${name}`);
}

function openVolunteerModal(){ document.getElementById('volunteerModal').classList.add('show'); }
function closeVolunteerModal(){ document.getElementById('volunteerModal').classList.remove('show'); }

function openResourceModal(){ document.getElementById('resourceModal').classList.add('show'); }
function closeResourceModal(){ document.getElementById('resourceModal').classList.remove('show'); }

function openContactModal(){ loadAdmins(); document.getElementById('contactModal').classList.add('show'); }
function closeContactModal(){ document.getElementById('contactModal').classList.remove('show'); }

async function submitVolunteerRequest(e){
  e.preventDefault();
  const eventId = document.getElementById('selectEvent').value;
  const msg = document.getElementById('volunteerMsg').value.trim();
  if(!eventId){ alert('Please select an event'); return; }
  try{
    await jpost('/user/request_volunteer', {user_id: userId, event_id: eventId, message: msg || 'I want to volunteer'});
    alert('‚úÖ Volunteer request submitted!');
    closeVolunteerModal();
  }catch(e){ alert('Error: ' + e.message); }
}

async function submitResourceRequest(e){
  e.preventDefault();
  const name = document.getElementById('resourceName').value.trim();
  const qty = parseInt(document.getElementById('resourceQty').value);
  const location = document.getElementById('campLocation').value.trim();
  const urgency = document.getElementById('urgencyLevel').value;
  const msg = document.getElementById('resourceMsg').value.trim();
  try{
    await jpost('/user/request_resource', {user_id: userId, resource_name: name, quantity: qty, camp_location: location, urgency, message: msg});
    alert('‚úÖ Resource request submitted!');
    closeResourceModal();
  }catch(e){ alert('Error: ' + e.message); }
}

async function sendAdminMessage(e){
  e.preventDefault();
  const adminId = document.getElementById('selectedAdminId').value;
  const subject = document.getElementById('messageSubject').value.trim();
  const message = document.getElementById('messageContent').value.trim();
  if(!adminId){ alert('Please select an admin'); return; }
  try{
    await jpost('/user/message_admin', {user_id: userId, admin_id: adminId, subject, message});
    alert('‚úÖ Message sent to admin!');
    closeContactModal();
  }catch(e){ alert('Error: ' + e.message); }
}

async function loadAll(){
  await Promise.all([loadEvents(), loadResources(), loadVolunteers(), loadNotifications()]);
}

loadAll();
setInterval(loadAll, 30000);
</script>
</body>
</html>
